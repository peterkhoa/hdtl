using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.ComponentModel;
using System.Web.Caching;

namespace hoachdinhtuonglai
{
    //public class AccountInRole
    //{
    //    private long _ID;

    //    public long ID
    //    {
    //        get { return _ID; }
    //        set { _ID = value; }
    //    }

    //    private string _RoleName;

    //    public string RoleName
    //    {
    //        get { return _RoleName; }
    //        set { _RoleName = value; }
    //    }

    //    private int _RoleID;

    //    public int RoleID
    //    {
    //        get { return _RoleID; }
    //        set { _RoleID = value; }
    //    }



    //    private long _AccountID;

    //    public long AccountID
    //    {
    //        get { return _AccountID; }
    //        set { _AccountID = value; }
    //    }
    //}

    public class AccountInRoleCollection : List<AccountInRole>
    {
        public AccountInRoleCollection() { }

        public AccountInRoleCollection(IEnumerable<AccountInRole> list) : base(list) { }
    }

    [DataObject]
    public static class AccountInRoleDA
    {
        static Database petapoco = ConnectionPP.getConnection();

        static Cache Cache = HttpContext.Current.Cache;

        public static AccountInRoleCollection SelectAll()
        {
            //var petapoco = ConnectionPP.getConnection();

            petapoco.EnableAutoSelect = false;
            petapoco.EnableNamedParams = false;
            petapoco.ForceDateTimesToUtc = false;

            AccountInRoleCollection acc = new AccountInRoleCollection(petapoco.Fetch<AccountInRole>(@"Select * from AccountInRole"));
            return acc;
        }



        public static AccountInRole SelectByID(long id)
        {
            //var petapoco = ConnectionPP.getConnection();

            petapoco.EnableNamedParams = false;
            petapoco.EnableAutoSelect = false;
            petapoco.ForceDateTimesToUtc = false;

            AccountInRole ac = petapoco.FirstOrDefault<AccountInRole>(@"Select * from AccountInRole where id=@0", id);

            return ac;
        }

        public static AccountInRole SelectByRoleIDnAccountID( int roleid,long accountid)
        {
            //var petapoco = ConnectionPP.getConnection();

            petapoco.EnableNamedParams = false;
            petapoco.EnableAutoSelect = false;
            petapoco.ForceDateTimesToUtc = false;

            AccountInRole ac = petapoco.FirstOrDefault<AccountInRole>(@"Select * from AccountInRole where [AccountID]=@0 and [RoleID]=@1", accountid,roleid);

            return ac;
        }

        public static AccountInRoleCollection SelectByRoleName(string name)
        {
            name = name.Trim().ToLower();
            //var petapoco = ConnectionPP.getConnection();

            petapoco.EnableNamedParams = false;
            petapoco.EnableAutoSelect = false;
            petapoco.ForceDateTimesToUtc = false;


            string cacheName = "SelectByRoleName_AccountInRole" + name;
            int cacheTimeOut = 5;
            AccountInRoleCollection ac = new AccountInRoleCollection();
            if (Cache[cacheName] == null)
            {
                ac = new AccountInRoleCollection(petapoco.Fetch<AccountInRole>(@"Select * from AccountInRole where RoleName=@0", name));
                Cache.Add(cacheName, ac, null, Cache.NoAbsoluteExpiration, TimeSpan.FromMinutes(cacheTimeOut), CacheItemPriority.High, null);
            }

            return (AccountInRoleCollection)Cache[cacheName];
        }


        public static AccountInRoleCollection SelectByRoleID(int roleID)
        {

            petapoco.EnableNamedParams = false;
            petapoco.EnableAutoSelect = false;
            petapoco.ForceDateTimesToUtc = false;

            AccountInRoleCollection ac = new AccountInRoleCollection(petapoco.Fetch<AccountInRole>(@"Select * from AccountInRole where [RoleID]=@0", roleID));

            return ac;
        }


        public static AccountInRoleCollection SelectByAccountID(long accountID)
        {

            //var petapoco = ConnectionPP.getConnection();

            petapoco.EnableNamedParams = false;
            petapoco.EnableAutoSelect = false;
            petapoco.ForceDateTimesToUtc = false;

            string cacheName = "SelectByAccountID_AccountInRole" + accountID;
            int cacheTimeOut = 5;

            AccountInRoleCollection ac = new AccountInRoleCollection();
            if (Cache[cacheName] == null)
            {
                ac = new AccountInRoleCollection(petapoco.Fetch<AccountInRole>(@"Select * from AccountInRole where [AccountID]=@0", accountID));
                Cache.Add(cacheName, ac, null, Cache.NoAbsoluteExpiration, TimeSpan.FromMinutes(cacheTimeOut), CacheItemPriority.High, null);
            }

            return (AccountInRoleCollection)Cache[cacheName];
        }


        public static AccountInRoleCollection SelectRoleByPageSize(int page, int pagesize)
        {
            if (page == 0)
                page = 1;
            //var petapoco = ConnectionPP.getConnection();

            petapoco.EnableAutoSelect = false;
            petapoco.ForceDateTimesToUtc = false;

            AccountInRoleCollection acc = new AccountInRoleCollection(petapoco.Fetch<AccountInRole>(@"Select * from AccountInRole where Activate=1").Skip((page - 1) * pagesize).Take(page * pagesize));

            return acc;
        }

        public static long Update(AccountInRole AccountInRole)
        {
            //var petapoco = ConnectionPP.getConnection();

            petapoco.EnableAutoSelect = false;
            petapoco.EnableNamedParams = false;
            petapoco.ForceDateTimesToUtc = false;

            long x = petapoco.Update("AccountInRole", "ID", AccountInRole, AccountInRole.ID);
            return x;
        }

        public static long Insert(AccountInRole AccountInRole)
        {
            //var petapoco = ConnectionPP.getConnection();

            petapoco.EnableAutoSelect = false;

            petapoco.ForceDateTimesToUtc = false;

            var x = petapoco.Insert("AccountInRole", "ID", true, AccountInRole);

            return long.Parse(x.ToString());
        }

        public static long Delete(AccountInRole AccountInRole)
        {
            //var petapoco = ConnectionPP.getConnection();

            petapoco.EnableAutoSelect = false;
            petapoco.EnableNamedParams = false;
            petapoco.ForceDateTimesToUtc = false;

            long x = petapoco.Delete("AccountInRole", "ID", AccountInRole, AccountInRole.ID);

            return x;
        }
    }
}